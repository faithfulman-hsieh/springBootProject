<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
             xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC"
             xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI"
             xmlns:flowable="http://flowable.org/bpmn"
             targetNamespace="http://www.flowable.org/processdef">

    <process id="advancedExpenseProcess" name="高階差旅報銷流程" isExecutable="true">

        <startEvent id="startEvent" name="提交報銷"></startEvent>

        <userTask id="task_submit" name="員工填寫/修改報銷單" flowable:assignee="${initiator}"></userTask>

        <exclusiveGateway id="gateway_amount_check" name="金額判斷"></exclusiveGateway>

        <userTask id="task_manager_approve" name="部門主管審批" flowable:candidateGroups="managers"></userTask>

        <userTask id="task_committee_vote" name="決策委員會會簽(3人)" flowable:candidateGroups="committee">
            <multiInstanceLoopCharacteristics isSequential="false">
                <loopCardinality>3</loopCardinality>
            </multiInstanceLoopCharacteristics>
        </userTask>

        <exclusiveGateway id="gateway_approval_decision" name="審批結果匯聚"></exclusiveGateway>

        <parallelGateway id="gateway_parallel_split" name="分辦開始"></parallelGateway>

        <userTask id="task_cashier" name="出納組匯款" flowable:candidateGroups="cashier"></userTask>

        <userTask id="task_accounting" name="會計組入帳歸檔" flowable:candidateGroups="accounting"></userTask>

        <parallelGateway id="gateway_parallel_join" name="分辦結束"></parallelGateway>

        <endEvent id="endEvent" name="流程結束"></endEvent>

        <sequenceFlow id="flow_1" sourceRef="startEvent" targetRef="task_submit"></sequenceFlow>
        <sequenceFlow id="flow_2" sourceRef="task_submit" targetRef="gateway_amount_check"></sequenceFlow>

        <sequenceFlow id="flow_3" sourceRef="gateway_amount_check" targetRef="task_manager_approve">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${amount <= 10000}]]></conditionExpression>
        </sequenceFlow>

        <sequenceFlow id="flow_4" sourceRef="gateway_amount_check" targetRef="task_committee_vote">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${amount > 10000}]]></conditionExpression>
        </sequenceFlow>

        <sequenceFlow id="flow_5" sourceRef="task_manager_approve" targetRef="gateway_approval_decision"></sequenceFlow>
        <sequenceFlow id="flow_6" sourceRef="task_committee_vote" targetRef="gateway_approval_decision"></sequenceFlow>

        <sequenceFlow id="flow_reject" sourceRef="gateway_approval_decision" targetRef="task_submit">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${approved == false}]]></conditionExpression>
        </sequenceFlow>

        <sequenceFlow id="flow_7" sourceRef="gateway_approval_decision" targetRef="gateway_parallel_split">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${approved == true}]]></conditionExpression>
        </sequenceFlow>

        <sequenceFlow id="flow_8" sourceRef="gateway_parallel_split" targetRef="task_cashier"></sequenceFlow>
        <sequenceFlow id="flow_9" sourceRef="gateway_parallel_split" targetRef="task_accounting"></sequenceFlow>

        <sequenceFlow id="flow_10" sourceRef="task_cashier" targetRef="gateway_parallel_join"></sequenceFlow>
        <sequenceFlow id="flow_11" sourceRef="task_accounting" targetRef="gateway_parallel_join"></sequenceFlow>

        <sequenceFlow id="flow_12" sourceRef="gateway_parallel_join" targetRef="endEvent"></sequenceFlow>

    </process>

    <bpmndi:BPMNDiagram id="BPMNDiagram_advancedExpenseProcess">
        <bpmndi:BPMNPlane bpmnElement="advancedExpenseProcess" id="BPMNPlane_advancedExpenseProcess">

            <bpmndi:BPMNShape bpmnElement="startEvent" id="BPMNShape_startEvent">
                <omgdc:Bounds height="30.0" width="30.0" x="150.0" y="250.0"/>
            </bpmndi:BPMNShape>

            <bpmndi:BPMNShape bpmnElement="task_submit" id="BPMNShape_task_submit">
                <omgdc:Bounds height="80.0" width="100.0" x="240.0" y="225.0"/>
            </bpmndi:BPMNShape>

            <bpmndi:BPMNShape bpmnElement="gateway_amount_check" id="BPMNShape_gateway_amount_check">
                <omgdc:Bounds height="40.0" width="40.0" x="390.0" y="245.0"/>
            </bpmndi:BPMNShape>

            <bpmndi:BPMNShape bpmnElement="task_manager_approve" id="BPMNShape_task_manager_approve">
                <omgdc:Bounds height="80.0" width="100.0" x="500.0" y="120.0"/>
            </bpmndi:BPMNShape>

            <bpmndi:BPMNShape bpmnElement="task_committee_vote" id="BPMNShape_task_committee_vote">
                <omgdc:Bounds height="80.0" width="100.0" x="500.0" y="330.0"/>
            </bpmndi:BPMNShape>

            <bpmndi:BPMNShape bpmnElement="gateway_approval_decision" id="BPMNShape_gateway_approval_decision">
                <omgdc:Bounds height="40.0" width="40.0" x="650.0" y="245.0"/>
            </bpmndi:BPMNShape>

            <bpmndi:BPMNShape bpmnElement="gateway_parallel_split" id="BPMNShape_gateway_parallel_split">
                <omgdc:Bounds height="40.0" width="40.0" x="750.0" y="245.0"/>
            </bpmndi:BPMNShape>

            <bpmndi:BPMNShape bpmnElement="task_cashier" id="BPMNShape_task_cashier">
                <omgdc:Bounds height="80.0" width="100.0" x="850.0" y="120.0"/>
            </bpmndi:BPMNShape>

            <bpmndi:BPMNShape bpmnElement="task_accounting" id="BPMNShape_task_accounting">
                <omgdc:Bounds height="80.0" width="100.0" x="850.0" y="330.0"/>
            </bpmndi:BPMNShape>

            <bpmndi:BPMNShape bpmnElement="gateway_parallel_join" id="BPMNShape_gateway_parallel_join">
                <omgdc:Bounds height="40.0" width="40.0" x="1000.0" y="245.0"/>
            </bpmndi:BPMNShape>

            <bpmndi:BPMNShape bpmnElement="endEvent" id="BPMNShape_endEvent">
                <omgdc:Bounds height="28.0" width="28.0" x="1100.0" y="251.0"/>
            </bpmndi:BPMNShape>

            <bpmndi:BPMNEdge bpmnElement="flow_1" id="BPMNEdge_flow_1">
                <omgdi:waypoint x="180.0" y="265.0"/>
                <omgdi:waypoint x="240.0" y="265.0"/>
            </bpmndi:BPMNEdge>

            <bpmndi:BPMNEdge bpmnElement="flow_2" id="BPMNEdge_flow_2">
                <omgdi:waypoint x="340.0" y="265.0"/>
                <omgdi:waypoint x="390.0" y="265.0"/>
            </bpmndi:BPMNEdge>

            <bpmndi:BPMNEdge bpmnElement="flow_3" id="BPMNEdge_flow_3">
                <omgdi:waypoint x="410.0" y="245.0"/>
                <omgdi:waypoint x="410.0" y="160.0"/>
                <omgdi:waypoint x="500.0" y="160.0"/>
            </bpmndi:BPMNEdge>

            <bpmndi:BPMNEdge bpmnElement="flow_4" id="BPMNEdge_flow_4">
                <omgdi:waypoint x="410.0" y="285.0"/>
                <omgdi:waypoint x="410.0" y="370.0"/>
                <omgdi:waypoint x="500.0" y="370.0"/>
            </bpmndi:BPMNEdge>

            <bpmndi:BPMNEdge bpmnElement="flow_5" id="BPMNEdge_flow_5">
                <omgdi:waypoint x="600.0" y="160.0"/>
                <omgdi:waypoint x="670.0" y="160.0"/>
                <omgdi:waypoint x="670.0" y="245.0"/>
            </bpmndi:BPMNEdge>

            <bpmndi:BPMNEdge bpmnElement="flow_6" id="BPMNEdge_flow_6">
                <omgdi:waypoint x="600.0" y="370.0"/>
                <omgdi:waypoint x="670.0" y="370.0"/>
                <omgdi:waypoint x="670.0" y="285.0"/>
            </bpmndi:BPMNEdge>

            <bpmndi:BPMNEdge bpmnElement="flow_reject" id="BPMNEdge_flow_reject">
                <omgdi:waypoint x="670.0" y="245.0"/>
                <omgdi:waypoint x="670.0" y="80.0"/> <omgdi:waypoint x="290.0" y="80.0"/>
                <omgdi:waypoint x="290.0" y="225.0"/> </bpmndi:BPMNEdge>

            <bpmndi:BPMNEdge bpmnElement="flow_7" id="BPMNEdge_flow_7">
                <omgdi:waypoint x="690.0" y="265.0"/>
                <omgdi:waypoint x="750.0" y="265.0"/>
            </bpmndi:BPMNEdge>

            <bpmndi:BPMNEdge bpmnElement="flow_8" id="BPMNEdge_flow_8">
                <omgdi:waypoint x="770.0" y="245.0"/>
                <omgdi:waypoint x="770.0" y="160.0"/>
                <omgdi:waypoint x="850.0" y="160.0"/>
            </bpmndi:BPMNEdge>

            <bpmndi:BPMNEdge bpmnElement="flow_9" id="BPMNEdge_flow_9">
                <omgdi:waypoint x="770.0" y="285.0"/>
                <omgdi:waypoint x="770.0" y="370.0"/>
                <omgdi:waypoint x="850.0" y="370.0"/>
            </bpmndi:BPMNEdge>

            <bpmndi:BPMNEdge bpmnElement="flow_10" id="BPMNEdge_flow_10">
                <omgdi:waypoint x="950.0" y="160.0"/>
                <omgdi:waypoint x="1020.0" y="160.0"/>
                <omgdi:waypoint x="1020.0" y="245.0"/>
            </bpmndi:BPMNEdge>

            <bpmndi:BPMNEdge bpmnElement="flow_11" id="BPMNEdge_flow_11">
                <omgdi:waypoint x="950.0" y="370.0"/>
                <omgdi:waypoint x="1020.0" y="370.0"/>
                <omgdi:waypoint x="1020.0" y="285.0"/>
            </bpmndi:BPMNEdge>

            <bpmndi:BPMNEdge bpmnElement="flow_12" id="BPMNEdge_flow_12">
                <omgdi:waypoint x="1040.0" y="265.0"/>
                <omgdi:waypoint x="1100.0" y="265.0"/>
            </bpmndi:BPMNEdge>

        </bpmndi:BPMNPlane>
    </bpmndi:BPMNDiagram>
</definitions>