<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:activiti="http://activiti.org/bpmn"
             xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
             xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
             xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
             typeLanguage="http://www.w3.org/2001/XMLSchema"
             expressionLanguage="http://www.w3.org/1999/XPath"
             targetNamespace="http://www.activiti.org/processdef">

    <process id="countersignProcess" name="聯合會簽流程" isExecutable="true">

        <startEvent id="startEvent" name="開始">
            <extensionElements>
                <activiti:formProperty id="assigneeList" name="會簽委員 (多選)" type="enum" required="true">
                    <activiti:value id="admin" name="管理員 (admin)"/>
                    <activiti:value id="user" name="一般用戶 (user)"/>
                    <activiti:value id="manager" name="經理 (manager)"/>
                </activiti:formProperty>

                <activiti:formProperty id="reason" name="會簽事由" type="string" required="true"/>
            </extensionElements>
        </startEvent>

        <sequenceFlow id="flow1" sourceRef="startEvent" targetRef="countersignTask"></sequenceFlow>

        <userTask id="countersignTask" name="委員聯合審批" activiti:assignee="${assignee}">
            <multiInstanceLoopCharacteristics isSequential="false"
                                              activiti:collection="assigneeList"
                                              activiti:elementVariable="assignee">
            </multiInstanceLoopCharacteristics>
        </userTask>

        <sequenceFlow id="flow2" sourceRef="countersignTask" targetRef="endEvent"></sequenceFlow>

        <endEvent id="endEvent" name="會簽結束"></endEvent>

    </process>

    <bpmndi:BPMNDiagram id="BPMNDiagram_Countersign">
        <bpmndi:BPMNPlane id="BPMNPlane_Countersign" bpmnElement="countersignProcess">
            <bpmndi:BPMNShape id="BPMNShape_startEvent" bpmnElement="startEvent">
                <dc:Bounds x="150" y="200" width="36" height="36" />
                <bpmndi:BPMNLabel>
                    <dc:Bounds x="158" y="240" width="22" height="14" />
                </bpmndi:BPMNLabel>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape id="BPMNShape_countersignTask" bpmnElement="countersignTask">
                <dc:Bounds x="260" y="178" width="100" height="80" />
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape id="BPMNShape_endEvent" bpmnElement="endEvent">
                <dc:Bounds x="430" y="200" width="36" height="36" />
                <bpmndi:BPMNLabel>
                    <dc:Bounds x="426" y="240" width="44" height="14" />
                </bpmndi:BPMNLabel>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNEdge id="BPMNEdge_flow1" bpmnElement="flow1">
                <di:waypoint x="186" y="218" />
                <di:waypoint x="260" y="218" />
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge id="BPMNEdge_flow2" bpmnElement="flow2">
                <di:waypoint x="360" y="218" />
                <di:waypoint x="430" y="218" />
            </bpmndi:BPMNEdge>
        </bpmndi:BPMNPlane>
    </bpmndi:BPMNDiagram>
</definitions>